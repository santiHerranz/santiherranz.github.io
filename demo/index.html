<!DOCTYPE html><html><head><title>JSK13 - 2022 - Escape from Death's hole</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style type="text/css">*{box-sizing:border-box;user-select:none}body,html{width:100%;height:100%;margin:0;padding:0}html{background-color:rgba(47,59,50,.52)}body{padding-top:0}#window{margin:0 auto;position:relative;font-family:Arial;box-shadow:0 8px 8px 3px rgba(0,0,0,.5)}@media only screen and (min-width:1024px){#window{width:1024px}}@media only screen and (max-width:768px){#window{width:768px}}@media only screen and (min-width:1536px){#window{width:1536px}}#window-game{width:100%;position:relative}@media only screen and (max-width:768px){#window-game{height:432px}}@media only screen and (min-width:1024px){#window-game{height:576px}}@media only screen and (min-width:1536px){#window-game{height:864px}}#game{width:100%;position:absolute;transform:translateZ(0)}@media only screen and (min-width:1024px){#game{height:576px}}@media only screen and (max-width:768px){#game{height:432px}}@media only screen and (min-width:1536px){#game{height:864px}}</style></head><body><div id="window"><div id="window-game"><canvas id="game"></canvas></div></div><br><div style="text-align: center; font-size: 12px; font-family: Helvetica">Created by <a href="https://github.com/santiHerranz">@santiherranz</a> for the <a href="https://js13kgames.com">js13kGames</a> game jam competition. Inspired by <a href="https://github.com/ferronsays">@ferronsays</a>'s The Last Spartan</div><script type="text/javascript">(t=>{var s={};function i(h){if(s[h])return s[h].exports;var e=s[h]={i:h,l:!1,exports:{}};return t[h].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=t,i.c=s,i.d=(t,s,h)=>{i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:h})},i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},i.t=(t,s)=>{if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.u)return t;var h=Object.create(null);if(i.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var e in t)i.d(h,e,(s=>t[s]).bind(null,e));return h},i.n=t=>{var s=t&&t.u?()=>t.default:()=>t;return i.d(s,"a",s),s},i.o=(t,s)=>({}.hasOwnProperty.call(t,s)),i.p="",i(i.s=2)})([function(t,s){const i=CanvasRenderingContext2D.prototype;i.mt=function(t,s){this.moveTo(t,s)},i.lt=function(t,s){this.lineTo(t,s)},i.tr=function(t,s){this.translate(t,s)},i.fr=function(t,s,i,h){this.fillRect(t,s,i,h)},i.s=function(){this.save()},i.r=function(){this.restore()},i.bp=function(){this.beginPath()},i.cp=function(){this.closePath()},i.fs=function(t){this.fillStyle=t},i.ss=function(t){this.strokeStyle=t},i.ft=function(t,s,i,h){this.fillText(t,s,i)},i.st=function(t,s,i,h=20,e="monospace"){this.miterLimit=2,this.font=h+"px "+e,this.strokeStyle="#000",this.lineWidth=4,this.strokeText(t,s,i),this.fillStyle="#fff",this.fillText(t,s,i)}},(t,s,i)=>{},function(t,s,i){i.r(s),i(0);var h=t=>{var s=new u(0,0);return s.x=(t.x-t.y)*l.x/2,s.y=(t.x+t.y)*l.y/2,s},e=t=>{var s=new u;return s.x=t.x/l.x+t.y/l.y,s.y=t.y/l.y-t.x/l.x,s},r=(t=1,s=0)=>Math.random()*(s-t)+t,a=()=>2*Math.random()-1,n=(t,s)=>~~(Math.random()*(s-t+1)+t),f=(t,s,i)=>t>=s&&i>=t,c=t=>null!=t;class o{constructor(t,s,i,h){this._=t||0,this.v=s||0,this.M=i||0,this.g=h||0,this.A=this._+this.M,this.k=this.v+this.g}set(t,s,i,h){this._=t,this.v=s,this.M=i||this.M,this.g=h||this.g,this.A=this._+this.M,this.k=this.v+this.g}get mid(){return new u(this._+this.M/2,this.v+this.g/2)}}class d{constructor(t=0,s=0){this.x=t,this.y=s}scale(t){return((...t)=>{console.assert(...t)})(null==t.x),new d(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}clampLength(t=1){const s=this.length();return s>t?this.scale(t/s):this}static L(t,s){return new d(t.x+s.x,t.y+s.y)}static S(t,s){return new d(t.x-s.x,t.y-s.y)}static T(t,s){return s instanceof d?new d(t.x*s.x,t.y*s.y):new d(t.x*s,t.y*s)}static O(t,s){return Math.sqrt(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2))}static R(t){return new d(Math.cos(t),Math.sin(t))}static K(t,s){return new d(t.x*Math.cos(s)-t.y*Math.sin(s),t.x*Math.sin(s)+t.y*Math.cos(s))}P(){return new d(this.x,this.y)}C(){return Math.sqrt(this.x*this.x+this.y*this.y)}V(){var t=this.C();return t>0?this.T(1/t):this}D(t){return this.C()>t?(this.V(),this.T(t)):this}L(t){return this.x+=t.x,this.y+=t.y,this}S(t){return this.x-=t.x,this.y-=t.y,this}T(t){return this.x*=t,this.y*=t,this}j(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}F(){return this.x=0,this.y=0,this}}var u=d,p=768,w=432;1024>innerWidth||(p=1024,w=576),1536>innerWidth||(p=1536,w=864);var l=new u(60,30),_=5,v=class{constructor(){this.B=[],this.Y=new u,this.q=0,this.I=0,this.J=0,this.U=!0,this.W=""+Math.floor(9999*Math.random()),this.G="gamenode"}H(){for(var t=this.Y.P(),s=this.N;s;)(t=u.K(t,s.I)).L(s.Y),s=s.N;return t}X(){for(var t=this.I,s=this.N;s;)t+=s.I,s=s.N;return t}Z(){for(var t=this.q,s=this.N;s;)t+=s.q,s=s.N;return t}$(t){t.N=this,this.B.push(t)}it(t){this.I+=this.J;for(var s=this.B.length;s--;){var i=this.B[s];i.it(t),i.U||this.B.splice(s,1)}}ht(t){var s=this.B.length;if(0!==s){for(t.s(),t.tr(this.Y.x,this.Y.y-this.q),t.rotate(this.I);s--;)this.B[s].ht(t);t.r()}}},M=class extends v{constructor(t=new u){super(),this.et=new u,this.rt=new u,this.at=0,this.nt=.98,this.ct=5,this.ot=10,this.dt=100,this.ut=1,this.pt=1,this.wt=1/0,this._t=-1,this.vt=0,this.Mt=100,this.bt=0,this.gt=!0,this.yt=1,this.G="go",this.Y=t}get xt(){return this.bt+this.q}$(t){t.N=this,this.B.push(t)}At(){this.U=!1,this.kt&&this.kt.At(),this.N=void 0}it(t){if(this.U)if(this.vt+=t,0>=this.zt||this._t&&-1!==this._t&&this.vt>=this._t)this.At();else{var s=this.Y.P();this.et.L(this.rt).D(this.dt*(t/1e3)),this.Y.L(this.et),this.rt.F(),this.at-=this.nt,this.q=Math.max(0,this.q+this.at),0===this.q&&(this.at=0,this.J=0),this.gt&&this.Lt(s),this.Et(),super.it(t)}}St(t){return pt.Ot.Tt&&0!==pt.Ot.Tt.Rt.length&&t.x<_&&t.x>=0&&t.y<_&&t.y>=0?pt.Ot.Tt.Rt[t.y][t.x]:null}Lt(t){var s=e(t),i=e(this.Y),r=this.St(i.P().j());if(!r||!c(r.Kt)){var a=s.P(),n=u.S(i,s),f=n.P();f.y=0;var o=this.St(u.L(s,f).j());o&&c(o.Kt)&&a.L(f);var d=n.P();d.x=0,(o=this.St(u.L(s,d).j()))&&c(o.Kt)&&a.L(d),this.Y=h(a),this.et.L(n.scale(-1))}}Et(){var t=e(this.H()).j(),s=this.St(t);if(s){var i=s.g-this.bt;0>i&&c(s)&&(this.q+=this.bt-s.g),this.bt=s.g,this.Pt=s.Kt,this.Ct=s,i>0&&(this.q=Math.max(0,this.q-i))}}},b=(t,s)=>{if("rgba(0,0,0,0)"==t)return t;t=t.substr(1);var i=parseInt(t,16),h=Math.round(2.55*s),e=(i>>16)+h,r=(i>>8&255)+h,a=(255&i)+h;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>r?1>r?0:r:255)+(255>a?1>a?0:a:255)).toString(16).slice(1)},g=class extends M{constructor(t,s,i=0,e,r){super(),this.Vt=!1,i=Math.min(200,Math.max(i,0)),this.Dt=e,this.jt=this.Kt=r,this.Ft=new u(t,s),this.Y=h(this.Ft),this.g=this.Bt=i}ht(t,s=0,i=0){if(s||!this.Vt&&pt.Ot.Yt(this.Y)){var h=~~this.g;i&&(h=i),t.drawImage(this.Dt,Math.floor(this.Kt*(l.x+1)),Math.floor(l.y*h+h*(h+1)/2-h),Math.floor(l.x),Math.floor(l.y+h),Math.floor(this.Y.x-l.x/2),Math.floor(this.Y.y-h),Math.floor(l.x),Math.floor(l.y+h))}super.ht(t)}},m=class extends M{constructor(){super()}ht(t){t.fs("#fff"),t.fr(9,9,p-9,22),t.st("LEVEL "+pt.Ot.qt.number+" "+pt.Ot.qt.title,10,26)}};class y extends M{constructor(t,s=10){super(),this.Rt=[],this.It=0,((t=_)=>{_=t})(s);for(var i=_;i--;){for(var h=[],e=_;e--;){var r,a=y.SAND;r=new g(e,i,20,t,a),this.$(r),h.push(r)}this.Rt.push(h.reverse())}this.Rt.reverse()}Jt(t){this.Ut=t,this.Wt=1,this.It=400}it(t){if(this.It=Math.max(this.It-t,0),this.Wt+=.15,this.Ut&&20>this.Wt)for(var s=this.Rt.length;s--;)for(var i=this.Rt[s],h=i.length;h--;){var e=i[h],r=Math.sqrt(Math.pow(this.Ut.x-e.Ft.x,2)+Math.pow(this.Ut.y-e.Ft.y,2)),a=Math.abs(this.Wt-r);e.g=1>a?Math.min(119,e.Bt+40*(1-a/1)*(this.It/400)):e.Bt}super.it(t)}}y.WATER=1,y.SAND=2,y.DIRT=3,y.GRASS=4,y.WHITE=5,y.BLACK=6,y.SPACER=7,y.TRANSPARENT=8,y.XTILE=9;var x=y,A=class extends M{constructor(t,s,i,h,e,r,a,n){super(t),this.q=s,this.at=i,this.et=h,this.Gt=e,this.Ht=r,this._t=a,this.Nt=n,this.Et()}it(t){super.it(t),this.Gt+=this.Ht*t}ht(t){t.fs("rgba(0,0,0,0.5"),t.fr(this.Y.x-this.Gt/4,this.Y.y+this.Gt/4-this.bt,this.Gt/2,this.Gt/2),t.fs(this.Nt),t.fr(this.Y.x-this.Gt/2,this.Y.y-this.Gt/2-this.xt,this.Gt,this.Gt),super.ht(t)}},k=class extends M{constructor(){super(...arguments),this.Xt=new u,this.Zt=0,this.at=0,this.Qt=0,this.$t=0,this.ts=0,this.ot=0,this.hs=0,this.Gt=0,this.es=0,this.rs=0,this.as=0,this.ns=0,this.cs=0,this.Nt="#fff",this.os=0,this.ds=0,this.us=-1,this.ps=!1,this.ws=[]}it(t){if(0===this.us)for(;this.ws.length<this.ts;)this.emit();super.it(t),this.ws=this.ws.filter(t=>t.U);var s=this.ts/this.ns;if(this.U&&s>0){var i=1/s;for(this.os+=t;this.ws.length<this.ts&&this.os>i;)this.emit(),this.os-=i;this.ds+=t,-1!==this.us&&this.us<this.ds&&this.At()}}emit(){var t=this.Xt.P().T(a());this.ps&&(t=u.K(t,this.X()));var s=this.ps?this.H():this.Y.P();s.x+=t.x,s.y+=t.y;var i=(this.ps?this.X():this.I)+this.$t*a(),h=this.ot+this.hs*a(),e=new u(Math.cos(i),Math.sin(i)).T(h),r=this.Gt+this.es*a();r=0>r?0:~~r;var n=this.rs+this.as*a();n=0>n?0:~~n;var f=this.at+this.Qt*a();f=0>f?0:~~f;var c=this.ns+this.cs*a(),o=(n-r)/c,d=new A(s,this.Zt,f,e,r,o,c,this.Nt);void 0!==this.nt&&(d.nt=this.nt),this.ps?(d.q=this.Z(),pt.Ot.ls(d)):this.$(d),this.ws.push(d)}},z=new class{constructor(){var t=t=>s=>{switch(console.log("InputKeyboard: "+s.code),s.code){case"ArrowRight":case"KeyD":this._s=t;break;case"ArrowDown":case"KeyS":this.vs=t;break;case"ArrowLeft":case"KeyA":this.Ms=t;break;case"ArrowUp":case"KeyW":this.bs=t;break;case"Space":this.gs=t;break;case"KeyJ":this.ms=t;break;case"KeyF":this.ys=t;break;case"KeyG":this.xs=t;break;case"KeyK":this.As=t;break;case"KeyM":this.ks=t;break;case"KeyP":this.zs=t;break;case"Digit1":this.Ls=t;break;case"Digit2":this.Es=t;break;case"NumpadEnter":case"Enter":this.Ss=t;break;case"Escape":this.Ts=t}};window.addEventListener("keydown",t(!0)),window.addEventListener("keyup",t(!1))}};class L{constructor(t,s){this.O=80,this.Os=576,this.Rs=new u,this.Ks=Math.PI/4,this.Ps=new o(0,0,0,0),this.Cs=new u(.5,.5),this.Vs=!0,this.Ds=.3,this.js=0,this.Fs(),this.Bs=t,this.Ys=s,this.qs=t/s,this.renderMoveBounds=!1,this.moveBoundsLen=100}shake(t){this.js=t}Is(t){t.s(),this.T(t),this.Js(t)}Us(t){if(this.renderMoveBounds){var s=this.Ps.mid;t.bp(),t.arc(s.x,s.y,this.moveBoundsLen,0,2*Math.PI,0),t.strokeStyle="yellow",t.stroke()}t.r()}T(t){t.scale(this.Cs.x,this.Cs.y)}Js(t){t.tr(-this.Ps._,-this.Ps.v)}it(t){this.js=Math.max(this.js-t,0),this.Ws(this.O+.05*(this.Os-this.O))}Fs(){this.Ps.set(this.Rs.x-this.Ps.M/2+(this.js?6*a():0),this.Rs.y-this.Ps.g/2+(this.js?6*a():0),this.O*Math.tan(this.Ks),this.Ps.M/this.qs),this.Cs.x=this.Bs/this.Ps.M,this.Cs.y=this.Ys/this.Ps.g}Gs(t){this.O/=t,this.Os=this.O,this.Fs()}Ws(t){this.O=t,this.Fs()}Hs(t,s){let i=this.Rs.P();var h=this.Ps.mid,e=u.S(new u(t,s),h);e.L(i),e.C()>0&&this.Rs.L(e),this.Fs()}Ns(t,s){var i=new u(t,s);this.Vs?this.Rs.S(u.S(this.Rs,i).T(this.Ds)):this.Rs=i.P(),this.Fs()}}class E extends v{Xs(t){return this.B.filter(s=>this.Zs(t,s))}Zs(t,s){if(t!==s&&t.Qs.W!==s.Qs.W)return this.$s(t,s)}$s(t,s){return t.p.x<s.p.x+s.w&&t.p.x+t.w>s.p.x&&t.p.y<s.p.y+s.h&&t.p.y+t.h>s.p.y}}class S extends M{constructor(t,s,i,h,e=-1,r=!1){super(),this.w=i,this.h=h,this.Qs=t,this.ti=s||new u,this.it(0),this._t=e,r&&pt.Ot.si.$(this)}it(t){super.it(t),this.p=this.Qs.Y.P().L(this.ti).L(new u(0,-this.Qs.q))}ht(t){t.s(),t.lineWidth=1,t.strokeStyle="#f00",t.bp(),t.rect(this.p.x,this.p.y,this.w,this.h),t.stroke(),t.r()}}var T=0,O=0;class R{constructor(t){this.time=null==t?void 0:T+t,this.setTime=t}set(t=0){this.time=T+t,this.setTime=t}unset(){this.time=void 0}isSet(){return null!=this.time}active(){return T<=this.time}elapsed(){return T>this.time}get(){return this.isSet()?T-this.time:0}p100(){return this.isSet()?((t,s=1,i=0)=>s-i?((t,s=1,i=0)=>i>t?i:t>s?s:t)((t-i)/(s-i)):0)(this.time-T,0,this.setTime):0}}const K=new AudioContext;function P(...t){return((...t)=>{const s=K.createBuffer(t.length,t[0].length,44100),i=K.createBufferSource();return t.map((t,i)=>s.getChannelData(i).set(t)),i.buffer=s,i.connect(K.destination),i.start(),i})(((t=1,s=.05,i=220,h=0,e=0,r=.1,a=0,n=1,f=0,c=0,o=0,d=0,u=0,p=0,w=0,l=0,_=0,v=1,M=0,b=0)=>{const g=2*Math.PI;let m,y,x=44100,A=f*=16153725318101989e-22,k=i*=(1+2*s*Math.random()-s)*g/x,z=[],L=0,E=0,S=0,T=1,O=0,R=0,K=0;for(c*=500*g/x**3,w*=g/x,o*=g/x,d*=x,u=u*x|0,y=(h=h*x+9)+(M*=x)+(e*=x)+(r*=x)+(_*=x)|0;y>S;z[S++]=K)++R%(100*l|0)||(K=a?a>1?a>2?a>3?Math.sin((L%g)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/g%2+2)%2:1-4*Math.abs(Math.round(L/g)-L/g):Math.sin(L),K=(u?1-b+b*Math.sin(g*S/u):1)*(K>0?1:-1)*Math.abs(K)**n*t*.3*(h>S?S/h:h+M>S?1-(S-h)/M*(1-v):h+M+e>S?v:y-_>S?(y-S-_)/r*v:0),K=_?K/2+(_>S?0:(y-_>S?1:(y-S)/_)*z[S-_|0]/2):K),m=(i+=f+=c)*Math.cos(w*E++),L+=m-m*p*(1-1e9*(Math.sin(S)+1)%2),T&&++T>d&&(i+=o,k+=o,T=0),!u||++O%u||(i=k,f=A,T=T||1);return z})(...t))}const C=()=>D(2,.2,()=>{P(1,0,493.8833,0,0,.25,0,1.61,1,0,286,50,20,0,-.111,0,0,1.1,0,.09)});let V=[];function D(t,s=.3,i){(t=>0==V.filter(s=>s.n==t).length)(t)&&(i(),((t,s=.3)=>{V.push({n:t,t:T+s})})(t,s))}class j extends M{constructor(){super(),this.si=new E,this.ii=[],this.hi=new L(p,w),this.hi.Rs=h(new u(5,5))}it(t){this.hi.it(t),z.Ls&&D(5,.3,()=>{P(.25,0,4,.01,0,.09,1,1.39,-41,-1.7,0,0,0,0,3,0,.01,.41,.04)}),z.Es,z.bs?this.ei.rt.y-=30:z.vs&&(this.ei.rt.y+=30),z.Ms?this.ei.rt.x-=30:z._s&&(this.ei.rt.x+=30),z.gs&&this.ei.ri()&&this.ei.ai&&this.ei.ni(),(z.ys&&this.ei.fi()||z.gs&&this.ei.fi()&&!this.ei.ai)&&(this.ei.ci=0,this.ei.at=10,this.ei.rt.T(3),C()),z.xs&&this.ei.oi()&&(this.ei.ci=0,this.ei.at=15,this.ei.di(),setTimeout(()=>D(4,.4,()=>{P(.5,0,224,.1,.05,.43,3,.35,-1.8,-.3,350,.02,.03,1.9,3,.3,0,.8,.06,.07)}),200)),z.ks&&(1e3>this.hi.O?this.hi.O=1e3:this.hi.O=500),this.si.it(t),super.it(t)}ls(t){this.$(t)}ui(t,s){}Yt(t){return f(t.x,this.hi.Ps._-100,this.hi.Ps.A+100)&&f(t.y,this.hi.Ps.v-100,this.hi.Ps.k+100)}}var F=class extends M{constructor(t=new u,s=new u(1,1)){super(t),this.pi=!0,this.Gt=s,this.gt=!0}it(t){super.it(t)}wi(t){}ht(t){}Et(){var t=e(this.H()).j(),s=this.St(t);if(s){var i=s.g-this.bt;0>i&&c(s)&&(this.q+=this.bt-s.g),this.bt=s.g,this.Pt=s.Kt,this.Ct=s,i>0&&(this.q=Math.max(0,this.q-i))}}},B=class extends F{constructor(t,s=new u,i=new u(15,15)){super(s),this.li="",this.Nt="#963",this.Gt=i,this.li=t,this.gt=!0;let h=this.Gt.P().T(1.1);this.kt=new S(this,new u(-h.x/2,-6-h.y/2-this.q-this.xt),h.x,h.y,-1,!0)}wi(t){super.wi(t),"human"==t.G&&("🔑"==this.li?(t!==pt.Ot.ei||t._i||D(6,1,()=>{P(1,0,300,.1,.3,.1,0,1.61,0,0,286,.06,.18,0,0,0,0,.4,.1,.09)}),t._i=!0):"🔒"==this.li?(t!==pt.Ot.ei||t.vi,t.vi=!0):pt.Ot.ei,setTimeout(()=>{this.At()},200))}ht(t,s={Y:new u,r:0},i=!1){t.s(),t.tr(0,-10),t.lineWidth=1,t.globalAlpha=this.yt,t.tr(this.Y.x+s.Y.x,this.Y.y+s.Y.y-(i?6:0)),t.rotate(s.r+this.I),t.fs("rgba(0,0,0,0.5"),t.bp(),t.ellipse(0,12+this.q,10,5,0,0,2*Math.PI),t.fill(),t.fs("rgba(0,0,0,1"),t.bp(),t.textAlign="center",t.textBaseline="middle",t.font="bold "+this.Gt.x+"px serif",t.ft(this.li,0,4),t.r()}},Y=class{constructor(t,s,i=!0){this.Mi=0,this.bi=[],this.gi=t,this.mi=i,["body","head","sword","shield","armL","armR","legL","legR"].forEach(i=>{for(var h=s[i]||[{f:0},{f:t}],e=1;e<h.length;e++)for(var r=h[e-1],a=h[e],n=a.f-r.f,f=0;n>f;f++){var c=f/n,o=this.bi[r.f+f],d=o||{},p={};if(r.hasOwnProperty("p")){var w=r.p[0]+(a.p[0]-r.p[0])*c,l=r.p[1]+(a.p[1]-r.p[1])*c;p.Y=new u(w,l)}else p.Y=new u(0,0);if(r.hasOwnProperty("r")){var _=r.r+(a.r-r.r)*c;p.r=_}else p.r=0;d[i]=p,o||this.bi.push(d)}})}get yi(){return this.bi[this.Mi]}get xi(){return!this.mi&&this.Mi===this.gi-1}it(){this.Mi+=1,this.Mi>this.gi-1&&(this.Mi=0)}};let q=-Math.PI/180*90;var I={body:[{f:0,p:[0,0]},{f:20,p:[0,0]}],head:[{f:0,p:[5,0]},{f:20,p:[5,0]}],armL:[{f:0,p:[2,6],r:q},{f:10,p:[2,6],r:q},{f:20,p:[2,6],r:q}],armR:[{f:0,p:[2,6],r:q},{f:10,p:[2,6],r:q},{f:20,p:[2,6],r:q}]},J={body:[{f:0,r:0,p:[0,0]},{f:20,r:0,p:[0,0]}],head:[{f:0,r:0,p:[5,0]},{f:5,r:0,p:[5,-.5]},{f:20,r:0,p:[5,0]}],armL:[{f:0,p:[2,6],r:q},{f:10,p:[2,6],r:q},{f:20,p:[2,6],r:q}],armR:[{f:0,p:[2,6],r:q},{f:10,p:[2,6],r:q},{f:20,p:[2,6],r:q}],legL:[{f:0,p:[1,0],r:.1},{f:10,p:[-1,0],r:-.1},{f:20,p:[1,0],r:.1}],legR:[{f:0,p:[-1,0],r:-.1},{f:10,p:[1,0],r:.1},{f:20,p:[-1,0],r:-.1}]};let U=-Math.PI/180*120;var W={body:[{f:0,p:[0,0]},{f:15,p:[0,.5]},{f:20,p:[0,0]}],head:[{f:0,p:[0,.5]},{f:5,p:[0,0]},{f:20,p:[0,.5]}],sword:[{f:0,r:U},{f:10,r:U-.045},{f:20,r:U}],shield:[{f:0,r:.14,p:[0,2.5]},{f:10,r:.16,p:[.5,3]},{f:20,r:.14,p:[0,2.5]}]},G={body:[{f:0,r:.1,p:[0,0]},{f:3,r:.1,p:[0,2]},{f:7,r:.1,p:[0,0]},{f:13,r:.1,p:[0,2]},{f:20,r:.1,p:[0,0]}],head:[{f:0,r:-.1,p:[0,0]},{f:3,r:-.1,p:[0,2]},{f:7,r:-.1,p:[0,0]},{f:13,r:-.1,p:[0,2]},{f:20,r:-.1,p:[0,0]}],sword:[{f:0,r:U-.24,p:[5,0]},{f:10,r:U-.2,p:[3,0]},{f:20,r:U-.24,p:[5,0]}],shield:[{f:0,r:.24,p:[0,0]},{f:10,r:.2,p:[3,0]},{f:20,r:.24,p:[0,0]}],legL:[{f:0,r:1.4},{f:10,r:-1.4},{f:20,r:1.4}],legR:[{f:0,r:-1.4},{f:10,r:1.4},{f:20,r:-1.4}]},H={body:[{f:0,r:.1,p:[0,4]},{f:10,r:.1,p:[0,3.5]},{f:20,r:.1,p:[0,4]}],head:[{f:0,p:[0,5]},{f:5,p:[0,4.5]},{f:20,p:[0,5]}],sword:[{f:0,r:.25,p:[-6,2]},{f:10,r:.25,p:[-6,1.5]},{f:20,r:.25,p:[-6,2]}],shield:[{f:0,p:[8,1.5]},{f:0,p:[8.25,1.75]},{f:20,p:[8,1.5]}]},N={body:[{f:0,r:.2,p:[0,2]},{f:3,r:.2,p:[0,3]},{f:7,r:.2,p:[0,2]},{f:13,r:.2,p:[0,3]},{f:20,r:.2,p:[0,2]}],head:[{f:0,r:-.1,p:[1,4]},{f:3,r:-.1,p:[1,5]},{f:7,r:-.1,p:[1,4]},{f:13,r:-.1,p:[1,5]},{f:20,r:-.1,p:[1,4]}],sword:[{f:0,r:.2,p:[-3,1]},{f:10,r:.25,p:[-6,1]},{f:20,r:.2,p:[-3,1]}],shield:[{f:0,p:[13.5,-1.75]},{f:10,p:[14,-2]},{f:20,p:[13.5,-1.75]}],legL:[{f:0,r:1},{f:10,r:-1},{f:20,r:1}],legR:[{f:0,r:-1},{f:10,r:1},{f:20,r:-1}]},X={body:[{f:0,r:.1},{f:16,r:.1}],head:[{f:0,r:-.1,p:[1,4]},{f:3,r:-.1,p:[1,5]},{f:7,r:-.1,p:[1,4]},{f:13,r:-.1,p:[1,5]},{f:16,r:-.1,p:[1,4]}],sword:[{f:0,r:-Math.PI-.5,p:[0,-20]},{f:4,r:1.5-Math.PI,p:[10,0]},{f:16,r:1.6-Math.PI,p:[10,0]}],shield:[{f:0,p:[0,0]},{f:16,p:[-8,0]}],legL:[{f:0,r:0},{f:8,r:1},{f:16,r:0}],legR:[{f:0,r:0},{f:8,r:-1},{f:16,r:0}]},Z={...X,body:[{f:0,r:.3,p:[0,2]},{f:16,r:.3,p:[0,2]}],head:[{f:0,r:-.1,p:[1,4]},{f:16,r:-.1,p:[1,4]}],sword:[{f:0,r:.2,p:[0,0]},{f:16,r:.2,p:[-8,0]}],shield:[{f:0,p:[14,0]},{f:4,p:[24,0]},{f:10,p:[24,0]},{f:16,p:[14,0]}]},Q={body:[{f:0,r:-.1,p:[0,0]},{f:6,r:-.1,p:[0,0]},{f:24,r:.5,p:[0,5]},{f:36,r:.5,p:[0,5]}],head:[{f:0,r:-.1,p:[8,6]},{f:6,r:-.1,p:[8,6]},{f:24,r:.3,p:[8,6]},{f:36,r:.3,p:[8,6]}],sword:[{f:0,r:-Math.PI/2,p:[0,-10]},{f:6,r:-Math.PI/2,p:[0,-10]},{f:20,r:-Math.PI/2,p:[10,10]},{f:36,r:-Math.PI/2,p:[10,10]}],shield:[{f:0,r:-.1,p:[10,-10]},{f:6,r:-.1,p:[10,-10]},{f:20,r:0,p:[16,12]},{f:36,r:0,p:[16,12]}],legL:[{f:0,r:1},{f:6,r:1.2},{f:24,r:.5},{f:36,r:.5}],legR:[{f:0,r:-1},{f:6,r:-1.2},{f:24,r:0},{f:36,r:0}]},$=class extends M{constructor(t,s){super(t),this.Ai=!1,this.Gt=s,this.gt=!0}wi(t){}it(t){0===this.q&&this.et.F();var s=this._t-this.vt;-1!==this._t&&s<.1*this._t&&(this.yt=s/(.1*this._t)),super.it(t)}bleed(){var t=new k;Object.assign(t,{Y:new u(0,0),I:this.I,ps:!1,Nt:"#db0000",ts:24,Gt:6,ns:5200,cs:800,ot:.2,hs:.2,$t:.2,us:3200}),this.$(t)}ki(t){t.s(),t.fs("rgba(0,0,0,0.5"),t.bp(),t.ellipse(0,5+this.q,10,5,0,0,2*Math.PI),t.fill(),t.r()}},tt=class extends ${constructor(t,s,i){super(t,s),this.Gt=s,this.zi=i,this.blinkTimer=new R}it(t){.005>r()&&this.blinkTimer.set(r(.2,.1)),super.it(t)}ht(t,s={Y:new u,r:0}){super.ht(t),t.s(),t.tr(this.Y.x+s.Y.x,this.Y.y+s.Y.y),this.Ai&&this.ki(t),t.rotate(s.r+this.I),t.ss("@000"),t.bp(),t.fs(this.zi.headColor),t.fr(-this.Gt.x/2,0,this.Gt.x,this.Gt.y);let i=this.Gt.y/20;t.bp(),t.fs(this.zi.headHairColor),t.fr(-this.Gt.x/2,0,this.Gt.x,this.Gt.y/4),t.bp(),t.fs(this.zi.headHairColor),t.fr(-this.Gt.x/2,0,this.Gt.x/8,i*this.zi.Li.y);const h=.5+.5*Math.cos(this.blinkTimer.p100()*Math.PI*2);t.strokeStyle="#000",t.fillStyle="#000";let e=this.Gt.y/20;t.bp(),t.ellipse(this.Gt.x/2.25,this.Gt.y/2,.8*e,2.7*e*h,0,0,2*Math.PI),t.closePath(),t.fill(),t.bp(),t.ellipse(this.Gt.x/4,this.Gt.y/2,1.1*e,3*e*h,0,0,2*Math.PI),t.closePath(),t.fill(),t.r()}},st=class extends ${constructor(t,s,i){super(t,s),this.Ei=0,this.zi=i,this.Ei=s.y}Si(){this.Ei-=4,10>this.Ei&&(this.zi.ai=!1,this.Ei=this.Gt.y)}Ti(t,s={Y:new u,r:0},i="yellow",h=!1){t.s(),t.lineWidth=1,t.globalAlpha=this.yt,t.tr(this.Y.x+s.Y.x,this.Y.y+s.Y.y-this.xt-(h?6:0)),this.Ai&&this.ki(t),t.rotate(s.r+this.I),t.lineWidth=2,t.fs("#d8d8d8"),t.fr(0,5,this.Gt.x/2,this.Ei),t.fs("#cccccc"),t.fr(this.Gt.x/2,5,this.Gt.x/2,this.Ei),t.fs("#963"),t.fr(0,5,this.Gt.x,5),t.fs("#333"),t.fr(this.Gt.x/4,0,this.Gt.x/2,5),t.r()}},it=class extends ${constructor(t,s,i){super(t,s),this.Oi=new u(12,18),this.Ri=new u(4,10),this.Ki=new u(4,4),this.Pi=new u(10,40),this.Ci=!1,this.zi=i,this.Oi=s}ht(t,s={Y:new u,r:0}){super.ht(t);var i=this.zi.Vi.yi;t.s(),t.lineWidth=1,t.tr(this.Y.x,this.Y.y),this.Ai&&this.ki(t),t.rotate(s.r+this.I),t.fs(this.zi.legColor),i.legL&&i.legR&&(t.s(),t.tr(-this.Ki.x/2-this.Oi.x/3,-2),t.rotate(i.legL.r),t.fr(0,this.Ki.y,this.Ki.x,this.Ki.y/3),t.r(),t.s(),t.tr(-this.Ki.x/2+this.Oi.x/3,-2),t.rotate(i.legR.r),t.fr(0,this.Ki.y,this.Ki.x,this.Ki.y/3),t.r()),t.s(),t.rotate(i.body.r),t.fs(this.zi.bodyColor),t.fr(-this.Oi.x/2+i.body.Y.x,-this.Oi.y+i.body.Y.y,this.Oi.x,.6*this.Oi.y),t.fs(this.zi.bodyColor),t.fr(-this.Oi.x/2+i.body.Y.x,.4*-this.Oi.y+i.body.Y.y,this.Oi.x,.45*this.Oi.y),t.fs(this.zi.armColor),i.armL&&i.armR&&(this.zi.Di?(t.s(),t.tr(-2+i.armL.Y.x,-this.Oi.y+this.Oi.y/6+i.armL.Y.y),t.rotate(i.armL.r),t.fr(0,0,this.Ri.x,this.Ri.y),t.r()):(t.s(),t.tr(-2+i.armR.Y.x,-this.Oi.y+this.Oi.y/6+i.armR.Y.y),t.rotate(i.armR.r),t.fr(0,0,this.Ri.x,this.Ri.y),t.r())),t.r(),t.r()}},ht=class extends F{constructor(t=new u,s=new u(10,40)){super(t),this.Nt="#963",this.Gt=s,this.Ei=s.y,this.gt=!0,this.kt=new S(this,new u(0,-10-this.Gt.y/2-7-this.xt),this.Gt.x,this.Ei,-1,!0)}it(t){super.it(t),1>this.Ei&&this.At(),this.et.F()}wi(t){super.wi(t),"human"==t.G&&!t.ai&&this.U&&(t.ai=!0,t.Pi=this.Gt,t.ji.Gt=this.Gt,t.ji.Ei=this.Ei,t===pt.Ot.ei&&D(5,.4,()=>{P(.25,0,259,.04,.06,.09,0,.25,12,0,0,0,0,.7,0,0,0,.86,.1)}),this.At())}ht(t,s={Y:new u,r:0},i=!1){t.s(),t.tr(0,-10),t.lineWidth=1,t.globalAlpha=this.yt,t.tr(this.Y.x+s.Y.x,this.Y.y+s.Y.y-this.xt-(i?6:0)),t.rotate(s.r+this.I),t.lineWidth=2,t.fs("#d8d8d8"),t.fr(0,-(this.Gt.y-18)/2-8,this.Gt.x/2,this.Ei),t.fs("#cccccc"),t.fr(this.Gt.x/2,-(this.Gt.y-18)/2-8,this.Gt.x/2,this.Ei),t.fs("#963"),t.fr(0,-(this.Gt.y-6)/2-5,this.Gt.x,5),t.fs("#333"),t.fr(this.Gt.x/4,-(this.Gt.y-6)/2-10,this.Gt.x/2,5),t.r()}};class et extends M{constructor(t,s="#fff"){super(t),this.ci=0,this.headColor="#E0AC69",this.headHairColor="#000",this.bodyColor="#000",this.armColor="#E0AC69",this.legColor="#E0AC69",this.Fi=new u(16,18),this.Li=new u(1,r(15,20)),this.Oi=new u(12,18),this.Ki=new u(4,4),this.Ri=new u(4,12),this.Pi=new u(10,40),this.ai=!1,this.Bi=3,this.Yi=!1,this.qi=350,this.Ii=0,this.Ji=0,this.Ui=0,this.Wi=500,this.Gi=0,this.Hi=500,this.Ni=0,this.bt=0,this.Ci=!1,this._i=!1,this.vi=!1,this.G="human",this.bodyColor=s,this.ot=100,this.dt=100,this.zt=this.wt=100,this.Xi=new Y(20,W),this.Zi=new Y(20,H),this.Qi=new Y(20,N),this.$i=new Y(20,G),this.th=new Y(16,X,!1),this.sh=new Y(16,Z,!1),this.ih=new Y(36,Q,!1),this.Vi=this.Xi,this.Di=!0,this.hh(),this.collisionTimer=new R(r(.1,1))}get xt(){return this.bt+this.q}fi(){return 0===this.q}ri(){return 0===this.q}oi(){return 0===this.q}it(t){this.ci+=t,this.Gi=Math.max(this.Gi-t,0),this.Ni=Math.max(this.Ni-t,0),this.Ii=Math.max(this.Ii-t,0),this.Ji=Math.max(this.Ji-t,0),this.Ui=Math.max(this.Ui-t,0),this.Vi,this.sh,this.Yi=this.Vi==this.th,this.collisionTimer.elapsed()&&(this.eh(),this.collisionTimer.set(r(.01,.05))),this.Di=this.et.x>=0,super.it(t),this.rh.it(t),this.ah(),this.Vi.it()}At(){this.kt&&(this.kt.U=!1);var t=new tt(this.Y.P(),this.Fi,this);t.color=this.rh.color,t.bleed(),t._t=5e3;var s=new it(this.Y.P(),this.Oi,this);if(s.Ri=this.Ri,s.Ki=this.Ki,s.bleed(),s._t=5e3,this.nh(s,40,n(1,4),3),this.nh(t,40,n(2,8),5),this.ai){var i=new ht(this.Y.P(),this.Pi);this.nh(i,40,n(.5,1.5),4),pt.Ot.ls(i)}if(this._i){var h=new B("🔑",this.Y.P());this.nh(h,40,n(.5,1.5),4),pt.Ot.ls(h)}this.vi&&(h=new B("🔒",this.Y.P()),this.nh(h,40,n(.5,1.5),4),pt.Ot.ls(h)),pt.Ot.ls(t),pt.Ot.ls(s),super.At()}hh(){this.fh=new it(new u(0,9),this.Oi,this),this.rh=new tt(new u(0,this.fh.Y.y-this.Oi.y-this.Fi.y),this.Fi,this),this.ji=new st(new u(1,this.fh.Y.y),this.Pi,this),this.rh.N=this.fh.N=this.ji.N=this}nh(t,s,i,h){t.Et(),t.q=s,t.at=i,t.et=u.R(Math.random()*Math.PI),t.J=a()/h,t.Ai=!0}ah(){[this.sh,this.th,this.ih].includes(this.Vi)&&!this.Vi.xi||(this.et.C()>.1?this.Ci?this.Vi=this.Qi:this.Vi=this.$i:this.Ci?this.Vi=this.Zi:this.Vi=this.Xi)}wi(t,s,i=!1){var h,e=u.S(this.Y,t.Y).V().x;if(this.Ci&&(0>e&&this.Di||e>0&&this.Di),this===pt.Ot.ei){let s=u.S(this.Y,t.Y).V().T(-30);t.rt.L(s),t.rt.D(this.pt),0==t.at&&(t.at+=i?5:3),t._i}t.ai&&i&&(t.ai=!1,(h=new ht(t.Y.P(),this.Pi)).Ei=t.ji.Ei,this.nh(h,40,n(.5,1.5),4),pt.Ot.ls(h)),this.ai&&i&&(this.ai=!1,(h=new ht(this.Y.P(),this.Pi)).Ei=this.ji.Ei,this.nh(h,40,n(.5,1.5),4),pt.Ot.ls(h)),this.Ji=200,this.Ui+=s?2e3:i?1200:0}eh(){if(!this.U)return;if(Math.floor(this.q)>5)return;let t=[];t.push({type:1,collision:new S(this,new u(-10,-22-this.xt+this.q),20,25,100,!0)}),this.ai&&this.Yi&&t.push({type:2,collision:new S(this,new u(this.Di?12:-12-this.ji.Ei,-25-this.xt+this.q),this.ji.Ei,30,100,!0)}),t.forEach(t=>{pt.Ot.si.Xs(t.collision).forEach(s=>{s.Qs.wi(this,2==t.type),s.Qs instanceof et&&pt.Ot.ui(this,s.Qs,t.type)})})}ni(){if(0>=this.Ii&&this.U){this.Vi=this.th,this.th.Mi=0;var t=this.Di?1:-1,s=pt.Ot.si.Xs(new S(this,new u(t*(this.Oi.x/2+10+(this.Di?0:36)),-30),36,20));s.length>0&&this.ji.Si(),s.forEach(t=>{t.Qs.wi(this)}),this.Ii=this.qi}}di(){this.ci>1e3||this.Ni>0||!this.U||(setTimeout(()=>{this.at=-14,pt.Ot.Tt&&pt.Ot.Tt.Jt(this.Ct.Ft),pt.Ot.si.Xs(new S(this,new u(-100,-100),200,200)).forEach(t=>{t.Qs.wi(this,!1,!0)}),this.pt=2.5},200),this.Vi=this.ih,this.ih.Mi=0,this.Ni=this.Hi,this.Ii=this.qi)}ht(t){if(pt.Ot.Yt(u.L(this.Y,new u(0,-this.xt)))){super.ht(t);var s=this.Vi.yi;t.s(),t.tr(0,-10),t.lineWidth=1,t.tr(this.Y.x,this.Y.y-this.xt),this.Ct&&!this.Ct.Vt&&(t.fs("rgba(0,0,0,0.5"),t.bp(),t.ellipse(0,12+this.q,10,5,0,0,2*Math.PI),t.fill()),this.Di||t.scale(-1,1),this.fh.ht(t,s.body),this.rh.ht(t,s.head),this.ai&&this.ji.Ti(t,s.sword,"#00f"),t.textAlign="center",t.textBaseline="middle",t.font="bold 15px serif",this._i&&(t.bp(),t.ft("🔑",0,4)),this.vi&&(t.bp(),t.ft("🔒",0,4)),t.r()}}}var rt=et,at=class extends rt{constructor(t,s){super(t,s),this.G="zombie",this.headHairColor="#000",this.headColor="#a4cc8c",this.armColor="#a4cc8c",this.legColor="#a4cc8c",this.zt=this.wt=100,this.Xi=new Y(20,I),this.$i=new Y(20,J)}},nt=class extends at{constructor(t,s){super(t,s),this.Fi=new u(32,36),this.Oi=new u(24,36),this.Pi=new u(20,80),this.hh()}},ft=class extends M{constructor(t=new u,s=new u(10,40)){super(t),this.Nt="#875638",this.Gt=s,this.gt=!0}it(t){super.it(t),this.et.F()}ht(t,s={Y:new u,r:0},i=!1){t.s(),t.tr(0,-10),t.lineWidth=1,t.globalAlpha=this.yt,t.tr(this.Y.x+s.Y.x,this.Y.y+s.Y.y-this.xt-(i?6:0)),t.rotate(s.r+this.I),t.lineWidth=2,t.fs(this.Nt),t.fr(0,-this.Gt.y,this.Gt.x/2,this.Gt.y),t.fs(this.Nt),t.fr(this.Gt.x/2,-this.Gt.y,this.Gt.x/2,this.Gt.y),t.r()}};class ct{constructor(){this.index=0,this.lastIndex=0,this.title="",this.tiles=5,this.max_zombies=0,this.max_humans=0,this.colors=[],this.oh=[],this.isEndGame=!1,this.colorsDef=[["#d7c799","#dfd2ad","#e7ddc1","#efe8d6","#f7f3ea","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#e7ddc1"],["#ffc799","#ffd2ad","#ffddc1","#ffe8d6","#fff3ea","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#ffddc1"],["#d7ff99","#dfffad","#e7ffc1","#efffd6","#f7ffea","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#e7ffc1"],["#d7c7ff","#dfd2ff","#e7ddff","#efe8ff","#f7f3ff","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#e7ddff"],["#d7c799","#dfd2ad","#e7ddc1","#efe8d6","#f7f3ea","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#e7ddc1"],["#d7c799","#dfd2ad","#e7ddc1","#efe8d6","#f7f3ea","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#e7ddc1"],["#d7c799","#dfd2ad","#e7ddc1","#efe8d6","#f7f3ea","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#e7ddc1"],["#d7c799","#dfd2ad","#e7ddc1","#efe8d6","#f7f3ea","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#e7ddc1"],["#d7c799","#dfd2ad","#e7ddc1","#efe8d6","#f7f3ea","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#e7ddc1"],["#fcc","#fcc","#fcc","#fcc","#fcc","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#fcc"],["#cfc","#cfc","#cfc","#cfc","#cfc","#fff","#000","rgba(0,0,0,0)","rgba(0,0,0,0)","#cfc"]],this.dh=[{t:"START",tt:9,z:1,h:1,s:1,c:this.colorsDef[0]},{t:"",tt:11,z:4,h:0,s:2,c:this.colorsDef[1]},{t:"",tt:11,z:4,h:2,s:2,c:this.colorsDef[2]},{t:"",tt:11,z:15,h:15,s:3,c:this.colorsDef[3]},{t:"",tt:20,z:10,h:10,s:5,c:this.colorsDef[4]},{t:"",tt:20,z:20,h:20,s:5,c:this.colorsDef[5]},{t:"",tt:20,z:50,h:50,s:5,c:this.colorsDef[6]},{t:"",tt:20,z:100,h:100,s:5,c:this.colorsDef[7]},{t:"",tt:20,z:100,h:100,s:5,c:this.colorsDef[8]},{t:"FINAL BOSS",tt:15,z:1,h:5,s:5,c:this.colorsDef[9]},{t:"FREEDOM",tt:50,z:0,h:10,s:5,c:this.colorsDef[10]}],this.index=this.lastIndex=0,this.uh()}get number(){return 1-this.dh.length+this.index}uh(){this.title=this.dh[this.index].t,this.tiles=this.dh[this.index].tt,this.max_zombies=this.dh[this.index].z,this.max_humans=this.dh[this.index].h,this.max_swords=this.dh[this.index].s,this.colors=this.dh[this.index].c,this.isEndGame=this.index==this.dh.length-1,this.isFinalBoss=this.index==this.dh.length-2,this.oh=[],this.isEndGame||(this.isFinalBoss||this.oh.push(()=>new B("🔑")),this.oh.push(()=>new B("💗")),this.oh.push(()=>{let t=[];for(let s=0;s<this.max_swords;s++)r()>.6?t.push(new ht(new u,new u(20,80))):t.push(new ht);return t}),this.oh.push(()=>new B("🍗")),this.oh.push(()=>new B("🍺"))),this.oh.reverse()}ph(){this.index>=0&&this.index+1<this.dh.length&&(this.lastIndex=this.index,this.index=this.index+1,this.uh())}wh(){this.index>0&&this.index-1<this.dh.length&&(this.lastIndex=this.index,this.index=this.index-1,this.uh())}}var ot=class extends j{constructor(t,s=new ct){super(),this.lh=[],this._h=[],this.vh=[],this.zombieMoveTimer=new R,this.ti=new u,this.Mh=new R,this.bh=new R,this.gh=1,this.oh=[],this.qt=s,this.Dt=t,this.mh=new m,setTimeout(()=>{this.uh()},10)}uh(){let t,s=this.Dt;if(this.yh=new M,this.Tt=new x(s,this.qt.tiles),this.$(this.yh),this.$(this.Tt),this.qt.isEndGame,!this.qt.isEndGame){for(let s=0;10>s;s++)if(t=new u(n(0,_-1),n(0,_-1)),t.x!=Math.floor(_/2)&&t.y!=Math.floor(_/2)){this.xh=this.Tt.St(t),this.xh.jt=this.xh.Kt=x.XTILE;break}var i=new u(_/2,_/2),e=h(i.L(new u(r(-1,1),r(-1,1)).T(r(1,_/2))));let s=new B("🔒",e);s.Y=e,s.q=0,this.yh.$(s)}var a=Math.floor(_/2),f=Math.floor(_/2);if(e=h(new u(f,a)),this.qt.index>0){let t=this.Tt.St(new u(f,a));t.g=25,t.Kt=x.TRANSPARENT,t&&(this.Ah=new g(t.Ft.x-1.5,t.Ft.y-1.5,t.g,t.Dt,x.SAND),this.Ah.g=1,this.yh.$(this.Ah),t.g=-500)}e=this.qt.lastIndex>this.qt.index?h(new u(t.x-.5,t.y-.5)):h(new u(f-.5,a-.5));let c=new rt(e,"#f00");c.ai=!1,this.qt.index<this.qt.lastIndex&&(c.q=200),this.ei=c,this.yh.$(this.ei);for(let t=0;t<this.qt.max_humans;t++){i=new u(_/2,_/2),e=h(i.L(new u(r(-1,1),r(-1,1)).T(r(1,_/2))));let t=new rt(e,"#500");t.q=20,t.et.L(new u(r(-1,1),r(-1,1)).T(r(.1,.5))),this.lh.push(t),this.yh.$(t)}this.hi.Os=this.hi.O=500,this.hi.Rs=this.ei.Y.P(),this.hi.Fs();for(let t=0;t<this.qt.max_zombies;t++){i=new u(_/2,_/2),e=h(i.L(new u(r(-1,1),r(-1,1)).T(r(1,_/2))));let t=this.qt.isFinalBoss?new nt(e,"#484"):new at(e,"#484");t.q=20,t.et.L(new u(r(-1,1),r(-1,1)).T(r(.1,.5))),this.qt.isFinalBoss&&(t._i=!0),this._h.push(t),this.yh.$(t)}this.oh=this.qt.oh,this.kh=null,this.bh.set(1)}drop(t,s){if(t){var i=new u(_/2,_/2),e=h(i.L(new u(r(-1,1),r(-1,1)).T(r(1,_/2))));t.Y=e,s&&(t.Y=s),t.q=50,this.vh.push(t),this.yh.$(t)}}ls(t){this.yh.$(t)}it(t){if(!this.ei)return;if(this.mh.it(t),-10>this.ei.q&&(this.zh=!0,C()),this._h.forEach(t=>{-10>t.q&&t.At()}),this.lh.forEach(t=>{-10>t.q&&t.At()}),this.kh||this.ei.vi&&this.ei._i){if(this.ei._i=!1,this.ei.vi=!1,this.kh||(setTimeout(()=>{D(4,.4,()=>{P(1,0,329.6276,.1,.31,.76,0,1.61,0,0,286,.15,.01,0,-5,0,0,.7,.1,.09)})},500),this.kh=new ft(this.xh.Y.P(),new u(3,200)),this.kh.q=500,pt.Ot.ls(this.kh),this.Mh.set(1)),this.xh&&this.ei.Ct===this.xh&&(this.ei.Y=this.xh.Y.P().L(new u(-3,l.y/2-10)),this.ei.et.F(),this.hi.O=500,this.hi.Os=this.hi.O,this.ei.ai)){this.ei.ji.At(),this.ei.ai=!1;let t=new ht(this.ei.Y.P());t.Y.L(new u(20,-50)),t.Et(),t.q=5,t.at=5,t.et=u.R(Math.random()*Math.PI*2).scale(200),t.J=a()/4,pt.Ot.ls(t)}(this.ei.fi()&&this.ei.Ct===this.xh&&this.Mh.elapsed()&&!this.ei.Lh||this.ei.Lh)&&(this.ei.Lh=!0,this.xh.g+=1),this.ei.Ct&&this.ei.Ct.g>100&&(this.Eh=!0)}if(this.ei.q>400&&(this.zh=!0),this.bh.elapsed()){if(this.oh.length){let t=this.oh.pop()();t instanceof Array?t.forEach(t=>{t.q=100,t.et=u.R(Math.random()*Math.PI),t.J=a()/1,this.drop(t,new u(2,2))}):this.drop(t)}this.bh.set(1),this.gh+=1}0==this.ei.zt&&(this.Eh=!0),this.hi.O/=1.0001,this.hi.Os=this.hi.O,this._h=this._h.filter(t=>t.U),this.lh=this.lh.filter(t=>t.U),.005>r()&&this.zombieMoveTimer.set(r(.2,.1));const s=.01+.01*Math.cos(this.zombieMoveTimer.p100()*Math.PI*2);let i=0;this._h.sort(()=>r(-1,1)).some(t=>{let h=new u(r(-1,1),r(-1,1)).T(s);return t.et.L(h),++i>100}),z.ks,z.Ls&&this.drop(new ht),this.ei.et.T(.5),this.ei.rt.T(.7),this.ei.dt*=this.ut,this.ei.pt=10,this.yh.B=this.yh.B.sort((t,s)=>s.Y.y-t.Y.y),super.it(t)}ui(t,s,i){if(("human"==t.G&&"zombie"==s.G||"human"==t.G&&"human"==s.G)&&2==i){D(4,.4,()=>{P(.5,0,150,0,.08,.13,4,2.84,.1,0,0,0,.07,1.7,0,.1,.09,.8,.08,.2)});let t=10;s.zt=Math.max(0,s.zt-t),this.bleed(s)}"zombie"==t.G&&s.G,super.ui(t,s)}bleed(t){var s=new k;Object.assign(s,{Y:new u(0,t.Oi.y-30),ps:!0,Nt:"#db0000",at:10,Qt:2,ts:12,Gt:4,ns:2e5,cs:100,ot:.25,hs:.2,$t:0,us:1e3,Zt:t.q}),this.$(s)}ht(t){this.ei&&this.hi.Ns(this.ei.Y.x,this.ei.Y.y-this.ei.xt),this.hi.Is(t),super.ht(t),this.hi.Us(t),this.mh.ht(t)}},dt=(t,s,i,h,e)=>{var r=l.x/2,a=l.x/2,n=.5*r+.5*a;t.s(),t.bp(),t.mt(s,i+n),t.lt(s-r,i+n-.5*r),t.lt(s-r,i+n-h-.5*r),t.lt(s,i+n-1*h),t.cp(),t.fillStyle=t.strokeStyle=b(e,-20),t.stroke(),t.fill(),t.bp(),t.mt(s,i+n),t.lt(s+a,i+n-.5*a),t.lt(s+a,i+n-h-.5*a),t.lt(s,i+n-1*h),t.cp(),t.fillStyle=t.strokeStyle=b(e,-10),t.stroke(),t.fill(),t.bp(),t.mt(s,i-h),t.lt(s-r,i-h+.5*r),t.lt(s-r+a,i-h+n),t.lt(s+a,i-h+.5*a),t.cp(),t.fillStyle=t.strokeStyle=e,t.strokeStyle=b(e,-10),t.stroke(),t.fill(),t.r()},ut=class extends j{constructor(){super(),this.Sh=new R(.5),this.Th=new R,this.Oh=1,this.mh=new m,this.mh.ht=t=>{t.fs("#ccc"),t.fr(9,9,p-18,w/4),t.textAlign="center",t.textBaseline="middle",t.st("ESCAPE FROM",p/2-9,w/8-w/18,p/20),t.st("DEATH'S HOLE",p/2-9,w/8+w/14,p/10),t.st("Press Enter to start",p/2,w/2+w/4,40+3*Math.cos(this.Sh.p100()))},this.hi.Rs=new u(24,-22),this.hi.Os=this.hi.O=400,this.ei=new rt(new u(-10,0)),this.ei.ai=!1,this.$(this.ei),this.Th.set(1)}it(t){if(super.it(t),this.Sh.elapsed()&&this.Sh.set(.5),this.Rh&&this.Rh.et.L(new u(-1,0)),this.Th.elapsed()){if(1==this.Oh){let t=new B("🔒",new u(-50,0));t.q=20,this.$(t)}if(2==this.Oh){let t=new B("🔑",new u(110,0));t.q=20,this.$(t)}3==this.Oh&&(this.Rh=new at(new u(70,0),"#484"),this.Rh.ai=!1,this.$(this.Rh)),5==this.Oh&&(this.sword=new ht(new u(-40,0)),this.sword.q=20,this.$(this.sword)),7==this.Oh&&(this.sword.At(),this.ei.ai=!0),this.Th.set(1),this.Oh+=1}if(this.Kh){let t=new rt(new u(0,0));this.Kh.Oi=t.Oi.scale(1+1*(this.Th.p100()-.5)),this.Kh.Fi=t.Fi.scale(1+1*(this.Th.p100()-.5)),this.Kh.hh(),this.Kh.et.F(),this.Kh.et.L(new u(this.Th.p100()-.5,0))}z.Ss&&(this.Eh=!0)}ht(t){this.hi.Is(t),super.ht(t),this.hi.Us(t),this.mh.ht(t)}};((t,s)=>{const i={sX:0,sY:0,eX:0,eY:0};var h="";const e=document.getElementById("game");e.addEventListener("touchstart",t=>{var s=t.touches[0];i.sX=s.screenX,i.sY=s.screenY},!1),e.addEventListener("touchmove",t=>{t.preventDefault();var s=t.touches[0];i.eX=s.screenX,i.eY=s.screenY},!1),e.addEventListener("touchend",t=>{var s;(i.eX-20>i.sX||i.eX+20<i.sX)&&i.eY<i.sY+50&&i.sY>i.eY-50&&(h=i.eX>i.sX?"r":"l"),(i.eY-40>i.sY||i.eY+40<i.sY)&&i.eX<i.sX+40&&i.sX>i.eX-40&&(h=i.eY>i.sY?"d":"u"),""!=h&&("l"==(s=h)?(z.Ms=!0,setTimeout(()=>{z.Ms=!1},500)):"r"==s&&(z._s=!0,setTimeout(()=>{z._s=!1},500)),"u"==s?(z.bs=!0,setTimeout(()=>{z.bs=!1},500)):"d"==s&&(z.vs=!0,setTimeout(()=>{z.vs=!1},500))),h=""},!1)})();var pt=new class{constructor(){this.qt=new ct,this.Ph=!1,this.Ch=!1,this.moveInput=new u,this.camDragged=!1,this.playerDragged=!1,this.Vh=[],this.Dh=performance.now(),this.jh=document.getElementById("game"),this.Fh=this.jh.getContext("2d"),this.jh.width=p,this.jh.height=w,this.jh.addEventListener("touchstart",t=>{1==z.Ss?z.Ss=!1:z.Ss=!0},!1),this.jh.oncontextmenu=()=>!1,this.qt.dh.forEach(t=>{this.Vh.push((t=>{var s=document.createElement("canvas"),i=s.getContext("2d");s.width=(l.x+1)*t.length,s.height=120*l.y+7260;for(var h=0;h<t.length;h++)for(var e=t[h],r=h*(l.x+1)+(l.x+1)/2,a=0;120>a;a++){var n=a,f=l.y*a+a*(a+1)/2;if(dt(i,r,f,n,e),h==t.length-1){var c=l.x/2*.5+l.x/2*.5;i.s(),i.tr(r-c+25,f-n+12),i.fs("rgba(20,20,20,.3)"),i.bp(),i.ellipse(4,2,4,2,0,0,2*Math.PI),i.cp(),i.fill(),i.r()}}return s})(t.c))}),this.Bh()}touchstart(t){t.preventDefault(),t.touches[0]}touchmove(t){t.preventDefault(),t.touches[0]}touchend(t){t.preventDefault()}Bh(){this.Yh(),this.Ot=new ut,this.Ph=!0,this.qh()}qh(){this.Ih=requestAnimationFrame(this.Jh.bind(this))}Yh(){cancelAnimationFrame(this.Ih)}Jh(t){this.Ih=requestAnimationFrame(this.Jh.bind(this));var s=Math.max(0,t-this.Dh);this.it(s),this.Dh=t,T=++O/60}Us(){this.Yh(),this.ph(),this.qh()}ph(){this.Yh(),this.qt.ph(),this.Uh(),this.qh()}wh(){this.Yh(),this.qt.wh(),this.Uh(),this.qh()}Uh(){this.Ot=new ot(this.Vh[this.qt.index],this.qt)}it(t){this.Ot.it(t),V=V.filter(t=>T<t.t),this.Ot.Eh&&(this.Ot.Eh=!1,this.Ot instanceof ut?this.Uh():this.Ot instanceof ot&&this.ph()),this.Ot.zh&&this.wh(),this.ht()}ht(){var{Fh:t,Ot:s}=this;t.clearRect(0,0,p,w),t.fs("rgba(0,0,0,1)"),t.fr(0,0,p,w),t.s(),s.ht(t),t.r()}};i(1)}]);</script></body></html>
